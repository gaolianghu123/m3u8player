<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M3U8转MP4在线工具</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    header {
      background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
      color: white;
      padding: 25px 30px;
      text-align: center;
    }

    header h1 {
      font-size: 28px;
      margin-bottom: 8px;
    }

    header p {
      opacity: 0.8;
      font-size: 16px;
    }

    .main-content {
      padding: 30px;
    }

    .input-section {
      margin-bottom: 25px;
    }

    .url-input {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }

    .url-input:focus {
      border-color: #4b6cb7;
      box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
      outline: none;
    }

    .button-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .btn {
      flex: 1;
      min-width: 180px;
      padding: 14px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .btn-primary {
      background: #4b6cb7;
      color: white;
    }

    .btn-primary:hover {
      background: #3a5a9f;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #2ecc71;
      color: white;
    }

    .btn-secondary:hover {
      background: #27ae60;
      transform: translateY(-2px);
    }

    .btn-tertiary {
      background: #e74c3c;
      color: white;
    }

    .btn-tertiary:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }

    .btn:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      transform: none;
    }

    .range-options {
      display: flex;
      gap: 15px;
      margin-top: 15px;
      align-items: center;
    }

    .range-input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }

    .status-section {
      margin: 30px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #4b6cb7;
    }

    .progress-container {
      margin-bottom: 20px;
    }

    .progress-bar {
      height: 12px;
      background: #e9ecef;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress {
      height: 100%;
      background: linear-gradient(90deg, #4b6cb7, #2ecc71);
      width: 0%;
      transition: width 0.3s;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #6c757d;
    }

    .segment-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 15px;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      background: white;
      border-radius: 8px;
    }

    .segment {
      width: 30px;
      height: 30px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }

    .segment.pending {
      background: #95a5a6;
    }

    .segment.downloading {
      background: #3498db;
    }

    .segment.completed {
      background: #2ecc71;
    }

    .segment.error {
      background: #e74c3c;
    }

    .segment:hover {
      transform: scale(1.1);
    }

    .actions {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .footer {
      text-align: center;
      padding: 20px;
      border-top: 1px solid #eee;
      color: #6c757d;
      font-size: 14px;
    }

    .footer a {
      color: #4b6cb7;
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    .error-message {
      color: #e74c3c;
      background: #fdf2f2;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
    }

    @media (max-width: 768px) {
      .button-group, .actions {
        flex-direction: column;
      }
      
      .btn {
        min-width: 100%;
      }
      
      .range-options {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>M3U8转MP4在线工具</h1>
      <p>无需下载软件，直接在浏览器中转换视频格式</p>
    </header>

    <div class="main-content">
      <div class="input-section">
        <input type="text" class="url-input" id="m3u8Url" 
               placeholder="请输入M3U8视频链接，例如：https://example.com/video.m3u8">
        
        <div class="button-group">
          <button class="btn btn-primary" id="downloadBtn">下载为MP4</button>
          <button class="btn btn-secondary" id="downloadOriginalBtn">下载为原格式</button>
          <button class="btn btn-tertiary" id="rangeDownloadBtn">指定范围下载</button>
        </div>
        
        <div class="range-options" id="rangeOptions" style="display: none;">
          <input type="number" class="range-input" id="startSegment" placeholder="起始片段">
          <span>至</span>
          <input type="number" class="range-input" id="endSegment" placeholder="结束片段">
          <button class="btn btn-primary" id="confirmRangeBtn">确认范围</button>
        </div>
      </div>

      <div class="status-section">
        <h3>转换状态</h3>
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress" id="progressBar"></div>
          </div>
          <div class="progress-info">
            <span id="progressText">等待开始...</span>
            <span id="progressPercent">0%</span>
          </div>
        </div>
        
        <div class="segment-container" id="segmentContainer">
          <!-- 片段状态将在这里动态生成 -->
        </div>
        
        <div class="actions">
          <button class="btn btn-primary" id="pauseBtn" disabled>暂停</button>
          <button class="btn btn-secondary" id="forceDownloadBtn" disabled>强制下载</button>
        </div>
        
        <div class="error-message" id="errorMessage"></div>
      </div>
    </div>

    <div class="footer">
      <p>注意：请仅转换您拥有或有权处理的视频内容</p>
      <p>本工具在您的浏览器中运行，视频数据不会上传到服务器</p>
    </div>
  </div>

  <script>
    // 简化的核心功能实现
    document.addEventListener('DOMContentLoaded', function() {
      // 获取DOM元素
      const m3u8UrlInput = document.getElementById('m3u8Url');
      const downloadBtn = document.getElementById('downloadBtn');
      const downloadOriginalBtn = document.getElementById('downloadOriginalBtn');
      const rangeDownloadBtn = document.getElementById('rangeDownloadBtn');
      const rangeOptions = document.getElementById('rangeOptions');
      const confirmRangeBtn = document.getElementById('confirmRangeBtn');
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressText');
      const progressPercent = document.getElementById('progressPercent');
      const segmentContainer = document.getElementById('segmentContainer');
      const pauseBtn = document.getElementById('pauseBtn');
      const forceDownloadBtn = document.getElementById('forceDownloadBtn');
      const errorMessage = document.getElementById('errorMessage');
      
      // 状态变量
      let isDownloading = false;
      let isPaused = false;
      let totalSegments = 0;
      let completedSegments = 0;
      let segmentStatus = [];
      
      // 示例M3U8链接
      m3u8UrlInput.value = 'https://upyun.luckly-mjw.cn/Assets/media-source/example/media/index.m3u8';
      
      // 事件监听
      downloadBtn.addEventListener('click', startDownload);
      downloadOriginalBtn.addEventListener('click', startDownloadOriginal);
      rangeDownloadBtn.addEventListener('click', toggleRangeOptions);
      confirmRangeBtn.addEventListener('click', confirmRange);
      pauseBtn.addEventListener('click', togglePause);
      forceDownloadBtn.addEventListener('click', forceDownload);
      
      // 开始下载为MP4
      function startDownload() {
        const url = m3u8UrlInput.value.trim();
        if (!url) {
          showError('请输入M3U8链接');
          return;
        }
        
        if (!url.includes('m3u8')) {
          showError('请输入有效的M3U8链接');
          return;
        }
        
        isDownloading = true;
        isPaused = false;
        resetUI();
        simulateDownload();
      }
      
      // 开始下载为原格式
      function startDownloadOriginal() {
        startDownload(); // 简化实现，实际中会有不同
      }
      
      // 切换范围选项显示
      function toggleRangeOptions() {
        rangeOptions.style.display = rangeOptions.style.display === 'none' ? 'flex' : 'none';
      }
      
      // 确认下载范围
      function confirmRange() {
        const start = parseInt(document.getElementById('startSegment').value);
        const end = parseInt(document.getElementById('endSegment').value);
        
        if (!start || !end || start > end) {
          showError('请输入有效的片段范围');
          return;
        }
        
        startDownload(); // 简化实现，实际中会使用指定范围
      }
      
      // 切换暂停状态
      function togglePause() {
        isPaused = !isPaused;
        pauseBtn.textContent = isPaused ? '继续' : '暂停';
        
        if (!isPaused) {
          // 继续下载逻辑
        }
      }
      
      // 强制下载现有片段
      function forceDownload() {
        alert('强制下载功能已触发');
        // 实际实现中会下载已完成的片段
      }
      
      // 重置UI状态
      function resetUI() {
        progressBar.style.width = '0%';
        progressText.textContent = '准备下载...';
        progressPercent.textContent = '0%';
        segmentContainer.innerHTML = '';
        hideError();
        
        downloadBtn.disabled = true;
        downloadOriginalBtn.disabled = true;
        rangeDownloadBtn.disabled = true;
        pauseBtn.disabled = false;
        forceDownloadBtn.disabled = true;
      }
      
      // 显示错误信息
      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
      }
      
      // 隐藏错误信息
      function hideError() {
        errorMessage.style.display = 'none';
      }
      
      // 模拟下载过程
      function simulateDownload() {
        // 模拟获取M3U8文件并解析
        progressText.textContent = '解析M3U8文件...';
        
        setTimeout(() => {
          // 模拟获取到20个片段
          totalSegments = 20;
          completedSegments = 0;
          segmentStatus = Array(totalSegments).fill('pending');
          
          progressText.textContent = `开始下载 ${totalSegments} 个片段...`;
          renderSegments();
          
          // 模拟下载过程
          const downloadInterval = setInterval(() => {
            if (isPaused) return;
            
            if (completedSegments < totalSegments) {
              // 更新一个片段的状态
              segmentStatus[completedSegments] = 'completed';
              completedSegments++;
              
              // 更新进度
              const progress = (completedSegments / totalSegments) * 100;
              progressBar.style.width = `${progress}%`;
              progressPercent.textContent = `${Math.round(progress)}%`;
              progressText.textContent = `已下载 ${completedSegments}/${totalSegments} 个片段`;
              
              renderSegments();
              
              // 如果所有片段都下载完成
              if (completedSegments === totalSegments) {
                clearInterval(downloadInterval);
                progressText.textContent = '下载完成，正在转换...';
                
                setTimeout(() => {
                  progressText.textContent = '转换完成！';
                  forceDownloadBtn.disabled = false;
                  alert('视频已成功转换并准备下载');
                }, 1000);
              }
            }
          }, 500);
        }, 1500);
      }
      
      // 渲染片段状态
      function renderSegments() {
        segmentContainer.innerHTML = '';
        
        for (let i = 0; i < totalSegments; i++) {
          const segment = document.createElement('div');
          segment.className = `segment ${segmentStatus[i]}`;
          segment.textContent = i + 1;
          segment.title = `片段 ${i + 1}: ${segmentStatus[i]}`;
          
          // 点击错误片段可以重试
          if (segmentStatus[i] === 'error') {
            segment.addEventListener('click', () => {
              segmentStatus[i] = 'pending';
              renderSegments();
            });
          }
          
          segmentContainer.appendChild(segment);
        }
      }
    });
  </script>
</body>
</html>
